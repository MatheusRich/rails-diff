# Rails::Diff

Compare your Rails application files with the ones generated by Rails main
branch. This helps you keep track of changes between your customized files and
the latest Rails templates.

## Installation

Add this line to your application's Gemfile:

```ruby
gem 'rails-diff'
```

And then execute:

```bash
$ bundle install
```

Or install it yourself as:

```bash
$ gem install rails-diff
```

## Usage

### Compare specific files

```bash
# Compare a single file
rails-diff file Dockerfile

# Compare multiple files
rails-diff file Dockerfile Gemfile

# Force regenerate Rails app by clearing cache
rails-diff file Dockerfile --clear-cache

# Fail if there are differences (useful for CI)
rails-diff file Dockerfile --fail-on-diff

# Compare a specific commit
rails-diff file Dockerfile --commit 7df1b8
```

### Compare generator files

```bash
# Compare files that would be created by a generator
rails-diff generated authentication

# Compare files with generator arguments
rails-diff generated scaffold Post title:string body:text

# Force regenerate Rails app by clearing cache
rails-diff generated scaffold Post --clear-cache

# Skip specific files or directories during the diff
rails-diff generated scaffold Post --skip app/views app/helpers

# Fail if there are differences (useful for CI)
rails-diff generated scaffold Post --fail-on-diff

# Compare a specific commit
rails-diff generated authentication --commit 7df1b8
```

### Options

#### --fail-on-diff

If this option is specified, the command will exit with a non-zero status code if there are any differences between your files and the generated ones. This can be particularly useful when using the gem in Continuous Integration (CI) environments.

#### --commit <commit_hash>

Specify the commit hash you want to compare against. If not provided, the latest
commit on main will be used by default.

#### --new-app-options <options>

Specify additional options to be used with the `rails new` command. This allows you to customize the generated Rails application, for example, by specifying a different database.

Example:

```bash
rails-diff file Dockerfile --new-app-options="--database=postgresql"
```

#### --skip <files/directories>

Skip specific files or directories during the diff.

```bash
rails-diff generated scaffold Post --skip app/views app/helpers
```

#### --clear-cache/--no-cache

Clear the cache directory to force cloning Rails and regenerating the Rails template app.

```bash
rails-diff file Dockerfile --clear-cache
```

#### --debug

Print debug information.

```sh
rails-diff file Gemfile --debug
```

or with an environment variable:

```sh
DEBUG=1 rails-diff file Gemfile
```

## How it works

When you run the diff, it will:

1. Clone the latest Rails from main branch
1. Generate a new Rails app with the same name as yours
1. Show you a colored diff between your file and the generated one

### Cache

The gem caches the generated Rails application to avoid regenerating it on every run. The cache is automatically invalidated when:
- Rails has new commits on main
- The cache directory doesn't exist (or is cleared with the `--clear-cache` option)
- You use `--new-app-options` with different options
- You change your `~/.railsrc` file
- You use `--commit` with a different commit

You can also force clear the cache by using the `--no-cache` option (or its alias `--clear-cache`) with any command.

## Development

After checking out the repo, run `bin/setup` to install dependencies. Then, run `rake spec` to run the tests.

To install this gem onto your local machine, run `bundle exec rake install`.

## Contributing

Bug reports and pull requests are welcome on GitHub at https://github.com/matheusrich/rails-diff.

## License

The gem is available as open source under the terms of the [MIT License](https://opensource.org/licenses/MIT).
